<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en">
	<head>
		
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta name="robots" content="index, follow" />
		<meta name="generator" content="RapidWeaver" />
		
		<title>Database Connection | ARGen Help</title>
		<link rel="stylesheet" type="text/css" media="all" href="../../rw_common/themes/simplebusiness/consolidated.css?rwcache=628038386" />
		
		
		
		
		
		
		
		<script type="text/javascript" src="../../rw_common/themes/simplebusiness/javascript.js?rwcache=628038386"></script>
		
		
		
	</head>
<body>
<div id="sidebarContainer"><!-- Start Sidebar wrapper -->
	<div id="navcontainer"><!-- Start Navigation -->
		<ul><li><a href="../../index.html" rel="">About ARGen</a></li><li><a href="../../whats-new/index.html" rel="">What's New in ARGen</a></li><li><a href="../../projects/index.html" rel="">Projects and Connections</a></li><li><a href="../../using-argen/index.html" rel="">Using ARGen</a></li><li><a href="../../using-activerecord/index.html" rel="" class="currentAncestor">Using ActiveRecord</a><ul><li><a href="index.html" rel="" id="current">Database Connection</a></li><li><a href="../../using-activerecord/records/index.html" rel="">Working With Records</a></li></ul></li><li><a href="../../more-help/index.html" rel="">More Help</a></li></ul>
	</div><!-- End navigation --> 
	<div id="sidebar"><!-- Start sidebar content -->
		<h1 class="sideHeader"></h1><!-- Sidebar header -->
		 <br /><!-- sidebar content you enter in the page inspector -->
		 <!-- sidebar content such as the blog archive links -->
	</div><!-- End sidebar content -->
</div><!-- End sidebar wrapper -->
	
<div id="container"><!-- Start container -->	
	<div id="pageHeader"><!-- Start page header -->
		
		<h1>ARGen Help</h1>
		<h2></h2>
	</div><!-- End page header -->
	
	<div id="contentContainer"><!-- Start main content wrapper -->
		<div id="content"><!-- Start content -->
			<h2 id="aboutthedesign">About the design</h2>

<p>Database connections are lazy loaded and pooled to be efficient with connections to the database. When the developer uses an ActiveRecord table class, <em>that</em> is when the connection is loaded. This can be triggered at any time by using the <code>Namespace.DB</code> function.</p>

<p>The database connection can be configured in the <code>Namespace.GetDatabase</code> function. A freshly generated project will open to this view, and there is also a <code>#pragma Error</code> to ensure that this function gets seen.</p>

<p>Connection pooling occurs in all types of projects, where previously this only happened for Web projects. The connection pool makes database connection thread-safe by providing threads with their own connections. Thread connections are cleaned up when the thread is destroyed. Web apps provide each session with their own connection.</p>

<h2 id="connectingtothedatabase">Connecting to the database</h2>

<p>ARGen will automatically set up database connection in generated projects, but will not write the password. The <code>Namespace.GetDatabase</code> function is where adjustments to the connection details are made. When the database connection details are ready, remove the <code>#pragma Error</code> line to allow the project to build.</p>

<p>Since the connection is lazy loaded from the <code>Namespace.DB</code> function, it may be necessary to ensure there is a database connection prior to using ActiveRecord objects. This should be done every time the thread context switches. In other words, at the beginning of <code>Thread.Run</code> grab a database reference from <code>Namespace.DB</code> to connect an instance for the thread.</p>

<p>Additionally, for web apps grab a database reference during the <code>Session.Opening</code> event.</p>

<p>Once connected for the first time, the database reference can be retrieved from <code>Namespace.DB</code>. It is not necessary to store the initial connection reference, the <code>Namespace</code> module maintains a connection lookup table.</p>
		</div><!-- End content -->
	</div><!-- End main content wrapper -->
	
	<div class="clearer"></div>
	<div id="breadcrumbcontainer"><!-- Start the breadcrumb wrapper -->
		
	</div><!-- End breadcrumb -->
	
	<div id="footer"><!-- Start Footer -->
		<p>&copy; 2018 - 2020 Tim Parnell</p>
	</div><!-- End Footer -->

</div><!-- End container -->
</body>
</html>
